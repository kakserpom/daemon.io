### mysql # MySQL #> MySQL {tpl-git PHPDaemon/Clients/MySQL}

```php
namespace PHPDaemon\Clients\MySQL;
```

Client for the DBMS [MySQL](http://mysql.com/)

#### use # Use

@TODO

In your application, you should receive an object MySQLClient through `Daemon::$appResolver->getInstanceByAppName('MySQLClient')` and use as described below.

##### prepare # Preparing the connection object

```
/*
  @method getConnection
  @description Establishes connection.
  @param string Optional. Address.
  @return integer Connection's ID.
*/
```

You should get MySQLClientSession object by the method $MySQLClient->getConnection(), then you can put your current request / session / anything else in the current context of the connection (in the context property).

Then use:

```php
$this->sql->onConnected(
    function($sql, $success) {
        if (!$success) {
            return;
        }
        // your connection-dependent code
    }
);
```

#### examples # Examples

```php
$sql->query('SHOW VARIABLES', 
   function($sql, $success) {
      $sql->context->queryResult = $sql->resultRows; // save the result
      $sql->context->wakeup(); // wake up the request immediately
   }
);
```

When the callback-function is called,  $sql->context contains your subject that you put there before. $sql->resultRows stores the result in an array of associative arrays. $sql->resultFields field contains the response as an array of associative arrays.

<!-- include-namespace path="\PHPDaemon\Clients\MySQL" level="" access="" -->
#### connection # Connection {tpl-git PHPDaemon/Clients/MySQL/Connection.php}

```php
namespace PHPDaemon\Clients\MySQL;
class Connection extends \PHPDaemon\Network\ClientConnection;
```

##### consts # Constants

<md:const>
@TODO DESCR
const STATE_STANDBY = 0
</md:const>

<md:const>
@TODO DESCR
const STATE_BODY = 1
</md:const>

<md:const>
@TODO DESCR
const PHASE_GOT_INIT = 1
</md:const>

<md:const>
@TODO DESCR
const PHASE_AUTH_SENT = 2
</md:const>

<md:const>
@TODO DESCR
const PHASE_AUTH_ERR = 3
</md:const>

<md:const>
@TODO DESCR
const PHASE_HANDSHAKED = 4
</md:const>

<md:const>
@TODO DESCR
const RS_STATE_HEADER = 0
</md:const>

<md:const>
@TODO DESCR
const RS_STATE_FIELD = 1
</md:const>

<md:const>
@TODO DESCR
const RS_STATE_ROW = 2
</md:const>

<div class="clearboth"></div>

##### properties # Properties

<md:prop>
/**
	 * @var integer Sequence. Pointer of packet sequence
	 */
public $seq = 0
</md:prop>

<md:prop>
/**
	 * @var integer Client flags
	 */
public $clientFlags = 239237
</md:prop>

<md:prop>
/**
	 * @var integer
	 */
public $threadId
</md:prop>

<md:prop>
/**
	 * @var string
	 */
public $scramble
</md:prop>

<md:prop>
/**
	 * @var string
	 */
public $serverver
</md:prop>

<md:prop>
/**
	 * @var integer
	 */
public $serverCaps
</md:prop>

<md:prop>
/**
	 * @var integer
	 */
public $serverLang
</md:prop>

<md:prop>
/**
	 * @var integer Server flags: http://dev.mysql.com/doc/internals/en/status-flags.html
	 */
public $serverStatus
</md:prop>

<md:prop>
/**
	 * @var integer Number of warnings generated by the command
	 */
public $warnCount
</md:prop>

<md:prop>
/**
	 * @var string
	 */
public $message
</md:prop>

<md:prop>
/**
	 * @var integer Charset number (see MySQL charset list)
	 */
public $charsetNumber = 33
</md:prop>

<md:prop>
/**
	 * @var string Database name
	 */
public $dbname = ''
</md:prop>

<md:prop>
/**
	 * @var array Result rows
	 */
public $resultRows = [ ]
</md:prop>

<md:prop>
/**
	 * @var array Result fields
	 */
public $resultFields = [ ]
</md:prop>

<md:prop>
/**
	 * @var object Property holds a reference to user's object
	 */
public $context
</md:prop>

<md:prop>
/**
	 * @var integer INSERT_ID()
	 */
public $insertId
</md:prop>

<md:prop>
/**
	 * @var integer Affected rows
	 */
public $affectedRows
</md:prop>

<md:prop>
/**
	 * @var integer Protocol version
	 */
public $protover = 0
</md:prop>

<md:prop>
/**
	 * @var integer Timeout
	 */
public $timeout = 120
</md:prop>

<md:prop>
/**
	 * @var integer Error number
	 */
public $errno = 0
</md:prop>

<md:prop>
/**
	 * @var string Error message
	 */
public $errmsg = ''
</md:prop>

<div class="clearboth"></div>

##### methods # Methods

<md:method>
/**
	 * Executes the given callback when/if the connection is handshaked
	 * @param  callable $cb Callback
	 * @callback $cb ( Connection $conn, boolean $success )
	 * @return void
	 */
public function onConnected($cb)
link:https://github.com/kakserpom/phpdaemon/blob/master/PHPDaemon/Clients/MySQL/Connection.php#L199
</md:method>

<md:method>
/**
	 * Called when the connection is handshaked (at low-level), and peer is ready to recv. data
	 * @return void
	 */
public function onReady()
link:https://github.com/kakserpom/phpdaemon/blob/master/PHPDaemon/Clients/MySQL/Connection.php#L219
</md:method>

<md:method>
/**
	 * Sends a packet
	 * @param  string  $packet Data
	 * @return boolean         Success
	 */
public function sendPacket($packet)
link:https://github.com/kakserpom/phpdaemon/blob/master/PHPDaemon/Clients/MySQL/Connection.php#L230
</md:method>

<md:method>
/**
	 * Builds length-encoded binary string
	 * @param  string $s String
	 * @return string    Resulting binary string
	 */
public function buildLenEncodedBinary($s)
link:https://github.com/kakserpom/phpdaemon/blob/master/PHPDaemon/Clients/MySQL/Connection.php#L240
</md:method>

<md:method>
/**
	 * Parses length-encoded binary integer
	 * @return integer Result
	 */
public function parseEncodedBinary()
link:https://github.com/kakserpom/phpdaemon/blob/master/PHPDaemon/Clients/MySQL/Connection.php#L266
</md:method>

<md:method>
/**
	 * Parse length-encoded string
	 * @return integer Result
	 */
public function parseEncodedString()
link:https://github.com/kakserpom/phpdaemon/blob/master/PHPDaemon/Clients/MySQL/Connection.php#L290
</md:method>

<md:method>
/**
	 * Generates auth. token
	 * @param  string $scramble Scramble string
	 * @param  string $password Password
	 * @return string           Result
	 */
public function getAuthToken($scramble, $password)
link:https://github.com/kakserpom/phpdaemon/blob/master/PHPDaemon/Clients/MySQL/Connection.php#L304
</md:method>

<md:method>
/**
	 * Sends auth. packet
	 * @return void
	 */
public function auth()
link:https://github.com/kakserpom/phpdaemon/blob/master/PHPDaemon/Clients/MySQL/Connection.php#L312
</md:method>

<md:method>
/**
	 * Sends SQL-query
	 * @param  string   $q        Query
	 * @param  callable $callback Optional. Callback called when response received
	 * @callback $callback ( Connection $conn, boolean $success )
	 * @return boolean            Success
	 */
public function query($q, $callback = NULL)
link:https://github.com/kakserpom/phpdaemon/blob/master/PHPDaemon/Clients/MySQL/Connection.php#L353
</md:method>

<md:method>
/**
	 * Sends echo-request
	 * @param  callable $callback Optional. Callback called when response received
	 * @callback $callback ( Connection $conn, boolean $success )
	 * @return boolean            Success
	 */
public function ping($callback = NULL)
link:https://github.com/kakserpom/phpdaemon/blob/master/PHPDaemon/Clients/MySQL/Connection.php#L363
</md:method>

<md:method>
/**
	 * Sends arbitrary command
	 * @param  string   $cmd      Command
	 * @param  string   $q        Data
	 * @param  callable $callback Optional
	 * @throws ConnectionFinished
	 * @callback $callback ( Connection $conn, boolean $success )
	 * @return boolean            Success
	 */
public function command($cmd, $q = '', $callback = NULL)
link:https://github.com/kakserpom/phpdaemon/blob/master/PHPDaemon/Clients/MySQL/Connection.php#L376
</md:method>

<md:method>
/**
	 * Sets default database name
	 * @param  string  $name   Database name
	 * @return boolean         Success
	 */
public function selectDB($name)
link:https://github.com/kakserpom/phpdaemon/blob/master/PHPDaemon/Clients/MySQL/Connection.php#L397
</md:method>

<md:method>
/**
	 * Called when new data received
	 * @return void
	 */
public function onRead()
link:https://github.com/kakserpom/phpdaemon/blob/master/PHPDaemon/Clients/MySQL/Connection.php#L411
</md:method>

<md:method>
/**
	 * Called when the whole result received
	 * @return void
	 */
public function onResultDone()
link:https://github.com/kakserpom/phpdaemon/blob/master/PHPDaemon/Clients/MySQL/Connection.php#L567
</md:method>

<md:method>
/**
	 * Called when error occured
	 * @return void
	 */
public function onError()
link:https://github.com/kakserpom/phpdaemon/blob/master/PHPDaemon/Clients/MySQL/Connection.php#L579
</md:method>

<div class="clearboth"></div>

#### connection-finished # ConnectionFinished {tpl-git PHPDaemon/Clients/MySQL/ConnectionFinished.php}

```php
namespace PHPDaemon\Clients\MySQL;
class ConnectionFinished extends \PHPDaemon\Exceptions\ConnectionFinished;
```

#### pool # Pool {tpl-git PHPDaemon/Clients/MySQL/Pool.php}

```php
namespace PHPDaemon\Clients\MySQL;
class Pool extends \PHPDaemon\Network\Client;
```

##### options # Options

 - `:p`server (array|string = 'tcp://root@127.0.0.1/')`  
 @todo

 - `:p`port (integer = 3306)`  
 @todo

 - `:p`maxconnperserv (integer = 32)`  
 @todo

##### consts # Constants

<md:const>
new more secure passwords
const CLIENT_LONG_PASSWORD = 1
</md:const>

<md:const>
Found instead of affected rows
const CLIENT_FOUND_ROWS = 2
</md:const>

<md:const>
Get all column flags
const CLIENT_LONG_FLAG = 4
</md:const>

<md:const>
One can specify db on connect
const CLIENT_CONNECT_WITH_DB = 8
</md:const>

<md:const>
Don't allow database.table.column
const CLIENT_NO_SCHEMA = 16
</md:const>

<md:const>
Can use compression protocol
const CLIENT_COMPRESS = 32
</md:const>

<md:const>
Odbc client
const CLIENT_ODBC = 64
</md:const>

<md:const>
Can use LOAD DATA LOCAL
const CLIENT_LOCAL_FILES = 128
</md:const>

<md:const>
Ignore spaces before '('
const CLIENT_IGNORE_SPACE = 256
</md:const>

<md:const>
New 4.1 protocol
const CLIENT_PROTOCOL_41 = 512
</md:const>

<md:const>
This is an interactive client
const CLIENT_INTERACTIVE = 1024
</md:const>

<md:const>
Switch to SSL after handshake
const CLIENT_SSL = 2048
</md:const>

<md:const>
IGNORE sigpipes
const CLIENT_IGNORE_SIGPIPE = 4096
</md:const>

<md:const>
Client knows about transactions
const CLIENT_TRANSACTIONS = 8192
</md:const>

<md:const>
Old flag for 4.1 protocol
const CLIENT_RESERVED = 16384
</md:const>

<md:const>
New 4.1 authentication
const CLIENT_SECURE_CONNECTION = 32768
</md:const>

<md:const>
Enable/disable multi-stmt support
const CLIENT_MULTI_STATEMENTS = 65536
</md:const>

<md:const>
Enable/disable multi-results
const CLIENT_MULTI_RESULTS = 131072
</md:const>

<md:const>
(none, this is an internal thread state)
const COM_SLEEP = 0x00
</md:const>

<md:const>
mysql_close
const COM_QUIT = 0x01
</md:const>

<md:const>
mysql_select_db
const COM_INIT_DB = 0x02
</md:const>

<md:const>
mysql_real_query
const COM_QUERY = 0x03
</md:const>

<md:const>
mysql_list_fields
const COM_FIELD_LIST = 0x04
</md:const>

<md:const>
mysql_create_db (deprecated)
const COM_CREATE_DB = 0x05
</md:const>

<md:const>
mysql_drop_db (deprecated)
const COM_DROP_DB = 0x06
</md:const>

<md:const>
mysql_refresh
const COM_REFRESH = 0x07
</md:const>

<md:const>
mysql_shutdown
const COM_SHUTDOWN = 0x08
</md:const>

<md:const>
mysql_stat
const COM_STATISTICS = 0x09
</md:const>

<md:const>
mysql_list_processes
const COM_PROCESS_INFO = 0x0a
</md:const>

<md:const>
(none, this is an internal thread state)
const COM_CONNECT = 0x0b
</md:const>

<md:const>
mysql_kill
const COM_PROCESS_KILL = 0x0c
</md:const>

<md:const>
mysql_dump_debug_info
const COM_DEBUG = 0x0d
</md:const>

<md:const>
mysql_ping
const COM_PING = 0x0e
</md:const>

<md:const>
(none, this is an internal thread state)
const COM_TIME = 0x0f
</md:const>

<md:const>
(none, this is an internal thread state)
const COM_DELAYED_INSERT = 0x10
</md:const>

<md:const>
mysql_change_user
const COM_CHANGE_USER = 0x11
</md:const>

<md:const>
sent by the slave IO thread to request a binlog
const COM_BINLOG_DUMP = 0x12
</md:const>

<md:const>
LOAD TABLE ... FROM MASTER (deprecated)
const COM_TABLE_DUMP = 0x13
</md:const>

<md:const>
(none, this is an internal thread state)
const COM_CONNECT_OUT = 0x14
</md:const>

<md:const>
sent by the slave to register with the master (optional)
const COM_REGISTER_SLAVE = 0x15
</md:const>

<md:const>
mysql_stmt_prepare
const COM_STMT_PREPARE = 0x16
</md:const>

<md:const>
mysql_stmt_execute
const COM_STMT_EXECUTE = 0x17
</md:const>

<md:const>
mysql_stmt_send_long_data
const COM_STMT_SEND_LONG_DATA = 0x18
</md:const>

<md:const>
mysql_stmt_close
const COM_STMT_CLOSE = 0x19
</md:const>

<md:const>
mysql_stmt_reset
const COM_STMT_RESET = 0x1a
</md:const>

<md:const>
mysql_set_server_option
const COM_SET_OPTION = 0x1b
</md:const>

<md:const>
mysql_stmt_fetch
const COM_STMT_FETCH = 0x1c
</md:const>

<md:const>

const FIELD_TYPE_DECIMAL = 0x00
</md:const>

<md:const>

const FIELD_TYPE_TINY = 0x01
</md:const>

<md:const>

const FIELD_TYPE_SHORT = 0x02
</md:const>

<md:const>

const FIELD_TYPE_LONG = 0x03
</md:const>

<md:const>

const FIELD_TYPE_FLOAT = 0x04
</md:const>

<md:const>

const FIELD_TYPE_DOUBLE = 0x05
</md:const>

<md:const>

const FIELD_TYPE_NULL = 0x06
</md:const>

<md:const>

const FIELD_TYPE_TIMESTAMP = 0x07
</md:const>

<md:const>

const FIELD_TYPE_LONGLONG = 0x08
</md:const>

<md:const>

const FIELD_TYPE_INT24 = 0x09
</md:const>

<md:const>

const FIELD_TYPE_DATE = 0x0a
</md:const>

<md:const>

const FIELD_TYPE_TIME = 0x0b
</md:const>

<md:const>

const FIELD_TYPE_DATETIME = 0x0c
</md:const>

<md:const>

const FIELD_TYPE_YEAR = 0x0d
</md:const>

<md:const>

const FIELD_TYPE_NEWDATE = 0x0e
</md:const>

<md:const>

const FIELD_TYPE_VARCHAR = 0x0f
</md:const>

<md:const>

const FIELD_TYPE_BIT = 0x10
</md:const>

<md:const>

const FIELD_TYPE_NEWDECIMAL = 0xf6
</md:const>

<md:const>

const FIELD_TYPE_ENUM = 0xf7
</md:const>

<md:const>

const FIELD_TYPE_SET = 0xf8
</md:const>

<md:const>

const FIELD_TYPE_TINY_BLOB = 0xf9
</md:const>

<md:const>

const FIELD_TYPE_MEDIUM_BLOB = 0xfa
</md:const>

<md:const>

const FIELD_TYPE_LONG_BLOB = 0xfb
</md:const>

<md:const>

const FIELD_TYPE_BLOB = 0xfc
</md:const>

<md:const>

const FIELD_TYPE_VAR_STRING = 0xfd
</md:const>

<md:const>

const FIELD_TYPE_STRING = 0xfe
</md:const>

<md:const>

const FIELD_TYPE_GEOMETRY = 0xff
</md:const>

<md:const>

const NOT_NULL_FLAG = 0x1
</md:const>

<md:const>

const PRI_KEY_FLAG = 0x2
</md:const>

<md:const>

const UNIQUE_KEY_FLAG = 0x4
</md:const>

<md:const>

const MULTIPLE_KEY_FLAG = 0x8
</md:const>

<md:const>

const BLOB_FLAG = 0x10
</md:const>

<md:const>

const UNSIGNED_FLAG = 0x20
</md:const>

<md:const>

const ZEROFILL_FLAG = 0x40
</md:const>

<md:const>

const BINARY_FLAG = 0x80
</md:const>

<md:const>

const ENUM_FLAG = 0x100
</md:const>

<md:const>

const AUTO_INCREMENT_FLAG = 0x200
</md:const>

<md:const>

const TIMESTAMP_FLAG = 0x400
</md:const>

<md:const>

const SET_FLAG = 0x800
</md:const>

<div class="clearboth"></div>

##### methods # Methods

<md:method>
/**
	 * Escapes the special symbols with trailing backslash
	 * @param  string $string
	 * @return string
	 */
public static function escape($string)
link:https://github.com/kakserpom/phpdaemon/blob/master/PHPDaemon/Clients/MySQL/Pool.php#L313
</md:method>

<md:method>
/**
	 * [value description]
	 * @param  mixed  $mixed
	 * @return string
	 */
public static function value($mixed)
link:https://github.com/kakserpom/phpdaemon/blob/master/PHPDaemon/Clients/MySQL/Pool.php#L330
</md:method>

<md:method>
/**
	 * [values description]
	 * @param  array  $arr
	 * @return string
	 */
public static function values($arr)
link:https://github.com/kakserpom/phpdaemon/blob/master/PHPDaemon/Clients/MySQL/Pool.php#L346
</md:method>

<md:method>
/**
	 * Escapes the special symbols with a trailing backslash
	 * @param  string $string
	 * @return string
	 */
public static function likeEscape($string)
link:https://github.com/kakserpom/phpdaemon/blob/master/PHPDaemon/Clients/MySQL/Pool.php#L362
</md:method>

<div class="clearboth"></div>


<!--/ include-namespace -->
